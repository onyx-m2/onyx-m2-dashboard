#!/usr/bin/env node
require('dotenv').config()
const axios = require('axios')
const fs = require('fs')
const util = require('util')

async function refresh(url, filename) {
  const { data } = await axios(url)
  fs.writeFileSync(`./src/generated/${filename}.js`, "export default " + util.inspect(data, {
    depth: Infinity,
    maxArrayLength: Infinity
  }))
}

if (!fs.existsSync('./src/generated')){
  fs.mkdirSync('./src/generated')
}
refresh(`https://cms.${process.env.M2_HOSTNAME}/menu`, 'menu-data')
refresh(`https://cms.${process.env.M2_HOSTNAME}/signals`, 'signals-data')
refresh(`https://${process.env.M2_HOSTNAME}/dbc?pin=${process.env.M2_PIN}`, 'dbc-data')